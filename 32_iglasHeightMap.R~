require(ggplot2)
require(raster)
require(tidyverse)
require(tmap)
require(gridExtra)
require(magrittr)


iglas = read.csv('data/iglasShtos.csv')
coordinates(iglas)=~x+y
crs(iglas) = "+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"

amaz2 = spTransform(amaz, crs(iglas))
iglas2 = iglas %>% crop(amaz2)                        						# pegar apenas pontos dentro dos limites do bioma
iglasEBA = raster::extract(heightRaster, iglas2)                        # extrai valor das variáveis ambientais para cada altura máxima mapeada
iglas2@data = cbind(iglas2@data, iglasEBA)                              # une arquivo clipado com shapefile original    
iglas2@data = na.omit(iglas2@data)                                      # remove observações com NA
writeSpatialShape(iglas2, "../amazon maximum height extras/iglasXeba")  # salva shapefile com os atributos clipados dos rasters

plot(iglas2$rh100, iglas2$iglasEBA)                                     # gráfico de dispersão icesat x eba
abline(lm(iglas2$rh100~iglas2$iglasEBA), col='red')                     # linha de tendência
summary(lm(iglas2$rh100~iglas2$iglasEBA))                               # resultado estatístico da linha de tendência

tm_shape(amaz2) + tm_polygons() + 
  tm_shape(iglas2) + tm_dots("rh100", size = 0.1, palette = "RdYlGn")

rm(iglas, ref, amaz2, iglasEBA)