---
title: "Maximum tree height in the Amazon"
output: html_notebook
---

```{r, message=FALSE}
require(ggplot2)
require(raster)
require(tidyverse)
require(tmap)
require(sf)
require(leaflet)
require(sp)
require(gridExtra)
require(magrittr)
require(factoextra) 
require(randomForest)
require(caret)
require(maptools)
require(dismo)
library(rgdal)
library(maps)
library(mapdata)
library(dismo)  
library(rJava)  
library(jsonlite)

Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre1.8.0_241')
```

## Envelop by MaxEnt

```{r}
modelEnv<-layers2estimate

# Alturas com limites estabelecidos (>50m, >60m, >70m e >75m)
maximas_50<-maximas[maximas$altura_cop>50,]
maximas_60<-maximas[maximas$altura_cop>60,]
maximas_70<-maximas[maximas$altura_cop>70,]
maximas_75<-maximas[maximas$altura_cop>75,]
#View(maximas)
```

### Heigth > 70

```{r maxEnt70}

# Coordenadas para a extens√£o de corte do mapa
model.extent<-extent(min(maximas_70$coords.x1)-10,max(maximas_70$coords.x1)+10,min(maximas_70$coords.x2)-10,max(maximas_70$coords.x2)+10)


# data frame com latitude e longitude
rattlerocc=data.frame(x1=maximas_70$coords.x1,x2=maximas_70$coords.x2) #first, just make a data frame of latitudes and longitudes for the model


fold <- kfold(rattlerocc, k=5) # add an index that makes five random groups of observations

oco_teste <- rattlerocc[fold == 1, ] # hold out one fifth as test data
oco_treino <- rattlerocc[fold != 1, ] # the other four fifths are training data


nicheHeight70 = maxent(modelEnv, oco_treino) #note we just using the training data
save(nicheHeight70, file = 'C:/Users/gorge/Documents/GIS DataBase/amazon maximum height extras/objects/maxentHeight70.Rdata')

plot(nicheHeight70)
response(nicheHeight70)


modelo_70m <- predict(nicheHeight70, modelEnv)


map = tm_shape(modelo_70m) + 
  tm_raster(n = 15,
            palette = "Greens",
            legend.hist = FALSE,
            title = "Prob. height > 70 m") +
  tm_shape(maximas_70) + 
  tm_dots("black", size = 0.07) +
  tm_shape(amaz) + tm_borders() +
  tm_legend(outside = TRUE) +
  tm_grid(lines = FALSE,
          labels.inside.frame = FALSE, 
          projection = "+proj=longlat")

tmap_save(map, "./plot/niche_height70_maxent.png", width = 1920, height = 1080)

```
